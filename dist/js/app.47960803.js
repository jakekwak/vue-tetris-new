(function(t){function e(e){for(var i,a,o=e[0],c=e[1],l=e[2],h=0,p=[];h<o.length;h++)a=o[h],Object.prototype.hasOwnProperty.call(s,a)&&s[a]&&p.push(s[a][0]),s[a]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);u&&u(e);while(p.length)p.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],i=!0,o=1;o<n.length;o++){var c=n[o];0!==s[c]&&(i=!1)}i&&(r.splice(e--,1),t=a(a.s=n[0]))}return t}var i={},s={app:0},r=[];function a(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=i,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(n,i,function(e){return t[e]}.bind(null,i));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var u=c;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"0dcb":function(t,e,n){"use strict";n("ae6d")},"138c":function(t,e,n){},"277b":function(t,e,n){},"48bf":function(t,e,n){t.exports=n.p+"media/lineClear.ccf66e78.mp3"},5339:function(t,e,n){t.exports=n.p+"media/complete.0dcb6783.mp3"},"536b":function(t,e,n){t.exports=n.p+"media/drop.c6fe8ef3.mp3"},"56d7":function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("f751"),n("097d");var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app"},[n("tetris")],1)},s=[],r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tetris"},[n("player",{ref:"player",attrs:{stage:t.stage,keys:{straight:32,left:37,rotate:38,right:39,down:40}}})],1)},a=[],o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"player"},[n("div",{staticClass:"game",style:{height:t.height*t.cellSize+"px",width:t.width*t.cellSize+"px"}},[n("ground",{ref:"ground",staticClass:"ground",attrs:{stage:t.stage},on:{clearRow:t.clearRow,clearAll:t.clearAll}}),t.curBlock?n("block",{ref:"shadow",attrs:{init:t.curBlock,stage:t.stage,shadow:!0}}):t._e(),t.curBlock?n("block",{key:t.curBlock.id,ref:"block",attrs:{init:t.curBlock,stage:t.stage}}):t._e()],1),n("div",{staticClass:"panel"},[n("h2",{staticClass:"nextText"},[t._v("Next")]),n("div",{staticClass:"nextBox"},[t.nextBlock?n("block",{key:t.nextBlock.id,staticClass:"next",style:t.nextBlockStyle,attrs:{init:t.nextBlock,stage:t.stage}}):t._e()],1),n("div",{staticClass:"score"},[n("div",{staticClass:"row"},[n("h4",{staticClass:"title"},[t._v("Level")]),n("span",[t._v(t._s(t._f("numberComma")(t.level)))])]),n("div",{staticClass:"row"},[n("h4",{staticClass:"title"},[t._v("Score")]),n("span",[t._v(t._s(t._f("numberComma")(t.score)))])]),n("div",{staticClass:"row"},[n("h4",{staticClass:"title"},[t._v("Rows")]),n("span",[t._v(t._s(t._f("numberComma")(t.rowCleared)))])])]),n("div",{staticClass:"statistics"},[n("span",{staticClass:"title"},[t._v("Statistics")]),t._l(t.statistics,(function(e,i){return n("div",{key:i,staticClass:"block"},[n("span",{staticClass:"symbol"},[t._v(t._s(i))]),n("span",{staticClass:"number"},[t._v(t._s(e))]),n("span",{staticClass:"rate"},[t._v(t._s(t._f("round")(e/t.statistics.TOTAL*100||0,2))+"%")])])}))],2),n("div",{staticClass:"buttons"},[t.state.playing?n("button",{on:{click:t.pause}},[t._v(t._s(t.state.pause?"Resume":"Pause "))]):n("button",{attrs:{autofocus:""},on:{click:t.start}},[t._v(t._s(t.state.gameover?"Restart":"Start"))]),n("button",{on:{click:t.muteSound}},[t._v("mute")])])])])},c=[],l=n("768b"),u=(n("ac6a"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{staticClass:"block",class:{shadow:t.shadow}},t._l(t.cells,(function(e){return n("cell",{key:e.id,attrs:{data:e.data,stage:t.stage,pos:e.pos}})})),1)}),h=[],p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"cell",class:t.display,style:t.style})},d=[],f={computed:{cellSize:function(){return this.stage.cellSize},width:function(){return this.stage.width},height:function(){return this.stage.height},blocks:function(){return this.stage.blocks},blockType:function(){return this.stage.blockType}}},m={name:"cell",props:["stage","data","pos"],mixins:[f],computed:{display:function(){return this.data.class},style:function(){return{width:this.cellSize+"px",height:this.cellSize+"px",left:this.pos[0]*this.cellSize+"px",bottom:this.pos[1]*this.cellSize+"px"}}}},v=m,g=(n("0dcb"),n("2877")),y=Object(g["a"])(v,p,d,!1,null,"0806bfbe",null),b=y.exports,k=0,x={name:"block",props:["stage","init","shadow"],mixins:[f],data:function(){var t=Object(l["a"])(this.init.pos,2),e=t[0],n=t[1];return{idx:0,x:e,y:n,fromCellId:k}},created:function(){k+=this.shapes.length},computed:{shapes:function(){return this.init.shapes},length:function(){return this.shapes.length},shape:function(){return this.shapes[this.idx%this.length]},style:function(){return{left:this.x*this.cellSize+"px",bottom:this.y*this.cellSize+"px"}},cells:function(){var t=this;return this.shape.map((function(e,n){var i=Object(l["a"])(e,2),s=i[0],r=i[1];return{pos:[s+t.x,r+t.y],data:{class:t.init.class},id:t.fromCellId+n}}))}},methods:{predictRotate:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.length,n=this.shapes,i=this.idx,s=this.x,r=this.y;return n[(i+1)%e].map((function(e){var n=Object(l["a"])(e,2),i=n[0],a=n[1];return[s+i+t,r+a]}))},predictMove:function(t,e){var n=this;return this.shape.map((function(i){var s=Object(l["a"])(i,2),r=s[0],a=s[1];return[r+n.x+t,a+n.y+e]}))},rotate:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.x+=t,this.idx++},move:function(t,e){this.x+=t,this.y+=e}},components:{cell:b}},w=x,C=(n("8c0c"),Object(g["a"])(w,u,h,!1,null,"80568e36",null)),S=C.exports,_=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"ground"},[n("transition-group",{attrs:{name:"cell"}},[t._l(this.ground,(function(e,i){return t._l(e,(function(e,s){return e?n("cell",{key:e.id,staticClass:"cell",attrs:{data:e.data,pos:[s,i],stage:t.stage}}):t._e()}))}))],2)],1)},O=[],T=(n("ac4d"),n("8a81"),n("5df3"),n("1c4c"),n("7f7f"),n("6b54"),n("2ef0")),A=n.n(T);function B(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=j(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var i=0,s=function(){};return{s:s,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,o=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){o=!0,r=t},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw r}}}}function j(t,e){if(t){if("string"===typeof t)return $(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$(t,e):void 0}}function $(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var E={name:"ground",mixins:[f],props:["stage"],data:function(){return{ground:[[]]}},methods:{reset:function(){var t=this.stage,e=t.width,n=t.height,i=e*n;this.ground=A.a.chain(i).times((function(){return null})).chunk(e).value()},checkTouched:function(t){var e,n=B(t);try{for(n.s();!(e=n.n()).done;){var i=Object(l["a"])(e.value,2),s=i[0],r=i[1];if(s<0||s>=this.width)return"wall";if(!(r>=this.height)&&(r<0||this.ground[r][s]))return"ground"}}catch(a){n.e(a)}finally{n.f()}return!1},clearRow:function(){for(var t=0,e=0,n=this.ground.length-1;n>=0;n--){var i=this.ground[n];A.a.every(i)?(this.ground.splice(n,1),this.ground.push(A.a.times(this.width,(function(){return null}))),t++,e++):A.a.every(i,(function(t){return!t}))&&e++}e===this.ground.length&&this.$emit("clearAll"),t&&this.$emit("clearRow",t)},push:function(t){var e,n=!0,i=B(t);try{for(i.s();!(e=i.n()).done;){var s=e.value,r=Object(l["a"])(s.pos,2),a=r[0],o=r[1];this.ground[o]?this.$set(this.ground[o],a,s):n=!1}}catch(c){i.e(c)}finally{i.f()}return this.$nextTick(this.clearRow),n}},components:{cell:b}},I=E,P=(n("97b1"),Object(g["a"])(I,_,O,!1,null,"d21e85ea",null)),z=P.exports,M=n("76d6"),R=n("8ea0"),L=n("7613"),D=n("ecd6"),F=n("7870"),J=n("5339"),N=n("8d6d"),W=n("536b"),X=n("48bf"),U={title:M,bgm1:R,bgm2:L,bgm3:D,bgm4:F,complete:J,gameover:N,drop:W,lineClear:X},Z={data:function(){return{currentAudio:null,muted:!1}},methods:{getAudio:function(t){return new window.Audio(U[t])},playEffect:function(t){!this.muted&&this.getAudio(t).play()},playSound:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.currentAudio&&this.currentAudio.pause(),this.currentAudio=this.getAudio(t),e&&(this.currentAudio.loop=!0),this.currentAudio.volume=.4,this.currentAudio.muted=this.muted,this.currentAudio.play()},pauseSound:function(){this.currentAudio.pause()},resumeSound:function(){this.currentAudio.play()},stopSound:function(){this.currentAudio.currentTime>0&&(this.currentAudio.pause(),this.currentAudio.currentTime=0)},muteSound:function(){this.muted=!this.muted,T.assign(this.currentAudio,{muted:this.muted})}}},G=0,q={name:"player",props:["stage","keys"],mixins:[f,Z],data:function(){return{curBlock:null,nextBlock:null,actionOf:{},tickInterval:0,rowCleared:null,level:null,score:null,state:null,statistics:null}},computed:{tickTime:function(){return 90*Math.max(11-this.level,1)},nextBlockStyle:function(){return{left:"calc(50% - ".concat(this.cellSize,"px)"),top:"calc(50% + ".concat(this.cellSize,"px)")}},canPlay:function(){var t=this.state,e=t.gameover,n=t.pause,i=t.playing;return!e&&!n&&i},stateText:function(){var t=this.state,e=t.gameover,n=t.pause;return e?"Game Over!":n?"Pause":""}},created:function(){var t=this;A.a.forEach(this.keys,(function(e,n){return t.$set(t.actionOf,e,n)})),window.addEventListener("keydown",this.keydown),this.reset()},methods:{reset:function(){Object.assign(this,{rowCleared:0,level:0,score:0,state:{playing:!1,gameover:!1,pause:!1},statistics:A()(this.stage.blocks).map((function(t){return[t,0]})).fromPairs().assign({TOTAL:0}).value()})},playBgm:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"bgm".concat(this.level%4+1),e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.playSound(t,e)},playFX:function(t){this.playEffect(t)},start:function(){this.state.playing||(this.reset(),this.$refs.ground.reset(),this.createNextBlock(),this.next(),this.state.playing=!0,this.playBgm())},tick:function(){this.canPlay&&this.move(0,-1)},setTick:function(){this.tickInterval=setInterval(this.tick,this.tickTime)},clearTick:function(){this.tickInterval=clearInterval(this.tickInterval)},resetTick:function(){this.clearTick(),this.setTick()},clearRow:function(t){this.rowCleared+=t,this.getScore([0,40,100,300,1200][t]*(this.level+1)),this.level=Math.floor(this.rowCleared/10),this.playFX("lineClear")},clearAll:function(){this.getScore(3e3*(this.level+1))},keydown:function(t){if(32===t.keyCode&&t.preventDefault(),this.state.playing){if(27===t.keyCode)return this.pause();if(this.canPlay)switch(this.actionOf[t.keyCode]){case"straight":this.moveStraight(),t.preventDefault();break;case"left":this.move(-1,0),t.preventDefault();break;case"rotate":this.rotate(),t.preventDefault();break;case"right":this.move(1,0),t.preventDefault();break;case"down":this.move(0,-1),this.resetTick(),t.preventDefault();break}}},pause:function(){this.state.pause?(this.state.pause=!1,this.resumeSound(),this.setTick()):(this.state.pause=!0,this.pauseSound(),this.clearTick()),this.$emit("pause",this.state.pause)},pushBlock:function(){var t=this.$refs,e=t.block,n=t.ground;this.getScore(3*(this.level+1));var i=n.push(e.cells);this.curBlock=null,i?this.next():this.gameover(),this.playFX("drop")},move:function(t,e){var n=this.$refs,i=n.block,s=n.ground,r=s.checkTouched(i.predictMove(t,e));return r?e<0&&this.pushBlock():(i.move(t,e),this.updateShadow()),r},moveStraight:function(){while(!this.move(0,-1));this.getScore(21+3*this.level)},getScore:function(t){this.canPlay&&(this.score+=t)},updateShadow:function(){var t=this.$refs,e=t.shadow,n=t.block,i=t.ground,s=n.idx,r=n.x,a=n.y;Object.assign(e,{idx:s,x:r,y:a});while(!i.checkTouched(e.predictMove(0,-1)))e.move(0,-1)},rotate:function(){var t=this,e=this.$refs,n=e.block,i=e.ground,s=n.predictRotate(),r=i.checkTouched(s);if(!r)return n.rotate(0),void this.updateShadow();var a=s.map((function(t){var e=Object(l["a"])(t,1),n=e[0];return n}));A()(1).range(A.a.max(a)-A.a.min(a)+1).flatMap((function(t){return[-t,t]})).forEach((function(e){if(!i.checkTouched(n.predictRotate(e)))return n.rotate(e),t.updateShadow(),!1}))},createNextBlock:function(){var t=A.a.sample(this.blocks);this.statistics[t]++,this.statistics.TOTAL++;var e=this.blockType[t];this.nextBlock={shapes:e,pos:[0,0],class:t,id:G++}},gameover:function(){this.state.gameover||(Object.assign(this.state,{gameover:!0,playing:!1}),this.clearTick(),this.$emit("gameover",this),this.playBgm("gameover",!1))},next:function(){var t=this;this.curBlock=Object.assign({},this.nextBlock),this.curBlock.pos=[Math.floor(this.width/2)-1,this.height],this.$nextTick((function(){if(t.resetTick(),!t.move(0,-1)){var e=t.$refs,n=e.block,i=e.ground;i.checkTouched(n.predictMove(0,-1))||n.move(0,-1),t.createNextBlock()}}))}},watch:{level:function(t){t&&this.playBgm()}},destroyed:function(){window.removeEventListener("keyodwn",this.keydown)},components:{ground:z,block:S}},H=q,K=(n("a433"),Object(g["a"])(H,o,c,!1,null,"5292759b",null)),Q=K.exports,V={name:"tetris",mixins:[f],data:function(){return{stage:{cellSize:30,width:10,height:20,blockType:{I:[[[-1,1],[0,1],[1,1],[2,1]],[[1,2],[1,1],[1,0],[1,-1]],[[2,0],[1,0],[0,0],[-1,0]],[[0,-1],[0,0],[0,1],[0,2]]],O:[[[0,0],[0,1],[1,1],[1,0]],[[0,1],[1,1],[1,0],[0,0]],[[1,1],[1,0],[0,0],[0,1]],[[1,0],[0,0],[0,1],[1,1]]],T:[[[1,-1],[2,0],[1,0],[0,0]],[[2,0],[1,1],[1,0],[1,-1]],[[1,1],[0,0],[1,0],[2,0]],[[0,0],[1,-1],[1,0],[1,1]]],S:[[[1,1],[2,1],[0,0],[1,0]],[[2,0],[2,-1],[1,1],[1,0]],[[1,-1],[0,-1],[2,0],[1,0]],[[0,0],[0,1],[1,-1],[1,0]]],Z:[[[0,1],[1,1],[1,0],[2,0]],[[2,1],[2,0],[1,0],[1,-1]],[[2,-1],[1,-1],[1,0],[0,0]],[[0,-1],[0,0],[1,0],[1,1]]],J:[[[2,-1],[2,0],[1,0],[0,0]],[[2,1],[1,1],[1,0],[1,-1]],[[0,1],[0,0],[1,0],[2,0]],[[0,-1],[1,-1],[1,0],[1,1]]],L:[[[0,-1],[0,0],[1,0],[2,0]],[[2,-1],[1,-1],[1,0],[1,1]],[[2,1],[2,0],[1,0],[0,0]],[[0,1],[1,1],[1,0],[1,-1]]]},blocks:["I","O","T","S","Z","J","L"]}}},components:{player:Q}},Y=V,tt=Object(g["a"])(Y,r,a,!1,null,null,null),et=tt.exports,nt=(n("77ed"),{name:"app",data:function(){return{}},components:{tetris:et}}),it=nt,st=Object(g["a"])(it,i,s,!1,null,null,null),rt=st.exports,at=n("2b0e");n("a481");at["a"].filter("numberComma",(function(t){return"".concat(t||0).replace(/\B(?=(\d{3})+(?!\d))/g,",")})),T.forEach(["ceil","floor","max","maxBy","mean","meanBy","min","minBy","round","sum","sumBy","clamp","camelCase","capitalize","endsWith","escape","escapeRegExp","kebabCase","lowerCase","lowerFirst","pad","padEnd","padStart","parseInt","repeat","replace","snakeCase","split","startCase","startsWith","template","toLower","toUpper","trim","trimEnd","trimStart","truncate","unescape","upperCase","upperFirst","words"],(function(t){return at["a"].filter(t,T[t])}));var ot=T.runInContext(),ct=T(["pull","pullAll","pullAllBy","pullAllWith","pullAt","remove"]).map((function(t){var e=ot[t];return[t,function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];var r=e.apply(void 0,[t].concat(i));return t instanceof Array&&t.push(),r}]})).fromPairs().value();A.a.mixin(ct),new at["a"]({render:function(t){return t(rt)},el:"app"})},5703:function(t,e,n){},7613:function(t,e,n){t.exports=n.p+"media/bgm2.2e36b89b.mp3"},"76d6":function(t,e,n){t.exports=n.p+"media/title.5f548f99.mp3"},7870:function(t,e,n){t.exports=n.p+"media/bgm4.45d2757e.mp3"},"8c0c":function(t,e,n){"use strict";n("277b")},"8d6d":function(t,e,n){t.exports=n.p+"media/gameover.d63c8781.mp3"},"8ea0":function(t,e,n){t.exports=n.p+"media/bgm1.2494a57d.mp3"},"97b1":function(t,e,n){"use strict";n("138c")},a433:function(t,e,n){"use strict";n("5703")},ae6d:function(t,e,n){},ecd6:function(t,e,n){t.exports=n.p+"media/bgm3.e4170271.mp3"}});
//# sourceMappingURL=app.47960803.js.map